import { Deck } from './Deck.js'; export class Game { constructor(numPlayers) { this.numPlayers = numPlayers; this.players = []; this.deck = new Deck(); this.humanPlayer = 0; this.currentPlayer = 0; this.communityCards = []; this.pot = 0; this.currentBet = 0; this.smallBlind = 50; this.bigBlind = 100; this.handComplete = false; this.street = 'preflop'; for (let i = 0; i < numPlayers; i++) { this.players.push({ id: i, stack: 2000, hand: [], bet: 0, folded: false, isAI: i !== 0, name: i === 0 ? 'You' : `Player ${i}` }); } } startNewHand() { this.communityCards = []; this.pot = 0; this.currentBet = this.bigBlind; this.street = 'preflop'; this.handComplete = false; this.deck.reset(); this.players.forEach(p => { p.hand = [this.deck.deal(), this.deck.deal()]; p.bet = 0; p.folded = false; }); this.dealSmallBlind(); this.dealBigBlind(); this.currentPlayer = (this.smallBlind + 2) % this.numPlayers; } dealSmallBlind() { const sbPlayer = this.players[this.smallBlind]; sbPlayer.stack -= 25; sbPlayer.bet = 25; this.pot += 25; } dealBigBlind() { const bbPlayer = this.players[this.bigBlind]; bbPlayer.stack -= this.bigBlind; bbPlayer.bet = this.bigBlind; this.pot += this.bigBlind; } fold() { this.players[this.currentPlayer].folded = true; this.advancePlayer(); } check() { this.advancePlayer(); } call() { const player = this.players[this.currentPlayer]; const amountNeeded = this.currentBet - player.bet; player.stack -= amountNeeded; player.bet += amountNeeded; this.pot += amountNeeded; this.advancePlayer(); } raise(amount) { const player = this.players[this.currentPlayer]; player.stack -= amount; this.pot += amount; this.currentBet = player.bet + amount; player.bet = this.currentBet; this.advancePlayer(); } aiAction() { const player = this.players[this.currentPlayer]; if (player.folded) { this.advancePlayer(); return; } const rand = Math.random(); if (rand < 0.6) { this.call(); } else if (rand < 0.85) { this.raise(Math.floor(Math.random() * 100) + 10); } else { this.fold(); } } advancePlayer() { this.currentPlayer = (this.currentPlayer + 1) % this.numPlayers; const activePlayers = this.players.filter(p => !p.folded).length; if (activePlayers === 1) { this.endHand(); } } endHand() { this.handComplete = true; const winner = this.players.find(p => !p.folded); if (winner) { winner.stack += this.pot; } this.resetForNextHand(); } resetForNextHand() { const btn = this.smallBlind; this.smallBlind = (btn + 1) % this.numPlayers; this.bigBlind = (btn + 2) % this.numPlayers; setTimeout(() => this.startNewHand(), 2000); } }
